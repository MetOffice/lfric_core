#!/bin/sh

# tweak_iodef:
#    replace relative path to LFRic dictionary with env symbol and
#    resolve env symbols 
# in iodef.xml before rose suite starts.

iodef=iodef.xml
case $# in 
0) ;;
1) iodef=$1 ;;
*) echo 'usage: tweak_iodef [iodef_file]' 1>&2; exit 2
esac

set -e
temp_file=$(mktemp)
trap 'rm -f $temp_file; exit 1' INT TERM EXIT
sed 's@\.\./metadata@$METADATA@' $iodef >$temp_file
rose env-cat $temp_file -o $iodef
trap '' INT TERM EXIT
rm -f $temp_file
